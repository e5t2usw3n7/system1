<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="http://zju-sys.pages.zjusct.io/sys1/sys1-sp24/lab5-1/" rel="canonical"/>
<link href="../lab4-1-appendix/" rel="prev"/>
<link href="../lab5-2/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.0, mkdocs-material-9.5.34" name="generator"/>
<title>第一部分 - 浙江大学24年春夏系统一实验</title>
<link href="../assets/stylesheets/main.35f28582.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"JetBrains Mono";--md-code-font:"JetBrains Mono"}</style>
<link href="../css/heti.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/utils/katex.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:500,500i,600,600i&amp;display=fallback" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#5-1-risc-v">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="浙江大学24年春夏系统一实验" class="md-header__button md-logo" data-md-component="logo" href=".." title="浙江大学24年春夏系统一实验">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            浙江大学24年春夏系统一实验
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              第一部分
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://git.zju.edu.cn/zju-sys/sys1/sys1-sp24" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    zju-sys/sys1/sys1-sp24
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="浙江大学24年春夏系统一实验" class="md-nav__button md-logo" data-md-component="logo" href=".." title="浙江大学24年春夏系统一实验">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    浙江大学24年春夏系统一实验
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://git.zju.edu.cn/zju-sys/sys1/sys1-sp24" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    zju-sys/sys1/sys1-sp24
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    首页
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    实验指导零
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            实验指导零
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab0-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab0-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab0-2-appendix/">
<span class="md-ellipsis">
    附录：verilog 与电路
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    实验指导一
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            实验指导一
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab1-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab1-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    实验指导二
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            实验指导二
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab2-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab2-1-appendix/">
<span class="md-ellipsis">
    附录：参数式编程
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    实验指导三
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            实验指导三
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-3/">
<span class="md-ellipsis">
    第三部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-1-appendix/">
<span class="md-ellipsis">
    附录：reg 与时序电路
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-3-appendix/">
<span class="md-ellipsis">
    附录：阻塞赋值
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    实验指导四
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            实验指导四
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab4-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab4-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab4-1-appendix/">
<span class="md-ellipsis">
    附录：SystemVerilog 高级语法
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    实验指导五
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            实验指导五
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    第一部分
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      实验目的
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      实验环境
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      背景知识
    </span>
</a>
<nav aria-label="背景知识" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#risc-v">
<span class="md-ellipsis">
      RISC-V 汇编语言
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#risc-v_1">
<span class="md-ellipsis">
      RISC-V 调用约定
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#spike-riscv-pk">
<span class="md-ellipsis">
      SPIKE 模拟器和 RISCV PK
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      跳转表
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      冒泡排序
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      实验步骤
    </span>
</a>
<nav aria-label="实验步骤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      实验环境配置
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#risc-v10">
<span class="md-ellipsis">
      理解简单RISC-V程序10%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#15">
<span class="md-ellipsis">
      理解递归汇编程序15%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#switch-5">
<span class="md-ellipsis">
      理解 switch 语句产生的跳转表5%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#20">
<span class="md-ellipsis">
      设计冒泡排序的汇编代码20%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#20_1">
<span class="md-ellipsis">
      设计斐波那契数列的汇编代码20%
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#70">
<span class="md-ellipsis">
      实验报告70%
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab5-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    实验指导 project
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            实验指导 project
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../project-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-bonus/">
<span class="md-ellipsis">
    Bonus
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-2-appendix/">
<span class="md-ellipsis">
    附录：处理器差分测试
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup/">
<span class="md-ellipsis">
    环境配置
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../issue/">
<span class="md-ellipsis">
    提交提问
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pull/">
<span class="md-ellipsis">
    提交修改
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      实验目的
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      实验环境
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      背景知识
    </span>
</a>
<nav aria-label="背景知识" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#risc-v">
<span class="md-ellipsis">
      RISC-V 汇编语言
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#risc-v_1">
<span class="md-ellipsis">
      RISC-V 调用约定
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#spike-riscv-pk">
<span class="md-ellipsis">
      SPIKE 模拟器和 RISCV PK
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      跳转表
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      冒泡排序
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      实验步骤
    </span>
</a>
<nav aria-label="实验步骤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      实验环境配置
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#risc-v10">
<span class="md-ellipsis">
      理解简单RISC-V程序10%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#15">
<span class="md-ellipsis">
      理解递归汇编程序15%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#switch-5">
<span class="md-ellipsis">
      理解 switch 语句产生的跳转表5%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#20">
<span class="md-ellipsis">
      设计冒泡排序的汇编代码20%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#20_1">
<span class="md-ellipsis">
      设计斐波那契数列的汇编代码20%
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#70">
<span class="md-ellipsis">
      实验报告70%
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://git.zju.edu.cn/zju-sys/sys1/sys1-sp24/-/blob/master/docs/lab5-1.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<h1 id="5-1-risc-v">实验<span class="heti-skip"><span class="heti-spacing"> </span>5-1: RISC-V<span class="heti-spacing"> </span></span>汇编程序设计<a class="headerlink" href="#5-1-risc-v" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<h2 id="_1">实验目的<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>理解<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>汇编程序</li>
<li>能够用<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>汇编指令编写简单的汇编程序</li>
</ul>
<h2 id="_2">实验环境<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>操作系统：Windows 10+ 22H2，Ubuntu 22.04+</li>
</ul>
<h2 id="_3">背景知识<a class="headerlink" href="#_3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="risc-v"><span>RISC-V<span class="heti-spacing"> </span></span>汇编语言<a class="headerlink" href="#risc-v" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>RISC-V<span class="heti-spacing"> </span></span>汇编语言是一种基于<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>指令集架构的低级程序设计语言，它被广泛用于嵌入式系统、操作系统和编译器的开发中。<span>RSIC-V<span class="heti-spacing"> </span></span>因为结构规整、内容精简而被广泛应用于课程教学。你们在课上学习了基本的<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>指令，但由编译器生成的汇编指令中可能含有一些你们没有接触过的指令或伪指令。当遇到这些指令时，请到<a href="https://riscv.org/technical/specifications/"><span class="heti-skip"><span class="heti-spacing"> </span>RISC-V ISA Specifications<span class="heti-spacing"> </span></span></a>查询相关文档（Volume 1, Unprivileged Specification<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<h3 id="risc-v_1"><span>RISC-V<span class="heti-spacing"> </span></span>调用约定<a class="headerlink" href="#risc-v_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>RISC-V<span class="heti-spacing"> </span></span>调用约定是指在函数调用时，调用方和被调用方之间所达成的一种规定，用于确保函数调用和返回的正确性。<span>RISC-V<span class="heti-spacing"> </span></span>调用约定规定了在函数调用和返回时需要保存哪些寄存器的值、哪些寄存器可以被调用者使用等等，以保证程序正确地执行。</p>
<p>以下是<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>调用约定的一些基本特点：</p>
<ul>
<li>参数传递：函数参数通常通过寄存器传递，前几个参数通常存储在<span><span class="heti-spacing"> </span>a0</span>、a1、a2、<span>a3<span class="heti-spacing"> </span></span>等寄存器中，更多的参数则会存储在栈中。</li>
<li>返回值：函数返回值通常存储在<span class="heti-skip"><span class="heti-spacing"> </span>a0<span class="heti-spacing"> </span></span>寄存器中，对于返回值比较复杂的情况，也可以将返回值存储在栈中。</li>
<li>寄存器的使用：<span>RISC-V<span class="heti-spacing"> </span></span>调用约定规定了哪些寄存器需要被调用方保存，哪些寄存器可以被调用者使用。一般来说，保存<span class="heti-skip"><span class="heti-spacing"> </span>callee-saved<span class="heti-spacing"> </span></span>寄存器是被调用者的责任，而调用者则可以使用<span class="heti-skip"><span class="heti-spacing"> </span>caller-saved<span class="heti-spacing"> </span></span>寄存器，但需要在函数调用之前将这些寄存器的值保存下来。</li>
<li>栈的使用：<span>RISC-V<span class="heti-spacing"> </span></span>调用约定还规定了在函数调用期间如何使用栈。在函数调用时，栈用于存储函数的参数、返回地址和<span class="heti-skip"><span class="heti-spacing"> </span>callee-saved<span class="heti-spacing"> </span></span>寄存器的值。在函数返回时，栈则被用于恢复调用者保存的寄存器和返回地址。</li>
</ul>
<p><span>RISC-V<span class="heti-spacing"> </span></span>调用约定的具体文档请查阅<a href="https://riscv.org/wp-content/uploads/2015/01/riscv-calling.pdf"><span><span class="heti-spacing"> </span>Calling Convention</span></a>。</p>
<h3 id="spike-riscv-pk"><span>SPIKE<span class="heti-spacing"> </span></span>模拟器和<span><span class="heti-spacing"> </span>RISCV PK</span><a class="headerlink" href="#spike-riscv-pk" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>SPIKE<span class="heti-spacing"> </span></span>是一个基于<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V ISA<span class="heti-spacing"> </span></span>模拟器，它可以让你在非<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>架构的机器上模拟执行<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>程序。</p>
<p>RISCV PK（RISC-V Proxy Kernel）是一个基于<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V ISA<span class="heti-spacing"> </span></span>的轻量级操作系统内核，它是一个开源项目，由<span class="heti-skip"><span class="heti-spacing"> </span>UC Berkeley<span class="heti-spacing"> </span></span>开发并维护。<span>RISCV PK<span class="heti-spacing"> </span></span>旨在提供一个最小化的操作系统内核，以便在不同的<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>处理器上运行各种用户空间应用程序。</p>
<h3 id="_4">跳转表<a class="headerlink" href="#_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>跳转表是一种用于跳转到不同代码块的数据结构。跳转表通常由一组指针或地址组成，这些指针或地址指向不同的代码块。跳转表的实现方式很简单，通常使用数组或哈希表来实现。跳转表通常用于替代大量的<span class="heti-skip"><span class="heti-spacing"> </span>if-else<span class="heti-spacing"> </span></span>语句或<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>语句，可以提高代码的执行效率。当需要根据一个值来选择不同的代码路径时，可以使用跳转表来实现。在跳转表中，每个值都对应着一个指针或地址，这个指针或地址指向对应的代码块。</p>
<p>跳转表在编程语言中广泛应用，特别是在一些低级语言中，如汇编语言和<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言。在<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>汇编中，跳转表通常使用<span><span class="heti-spacing"> </span>la</span>（load address）指令来加载地址，然后使用<span><span class="heti-spacing"> </span>jr</span>（jump register）或<span><span class="heti-spacing"> </span>jalr</span>（jump and link register）指令来进行跳转。</p>
<p>关于跳转表的具体介绍，请参考<span><span class="heti-spacing"> </span>CSAPP</span>（深入了解计算机系统）第三章关于<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>语句的介绍。</p>
<h3 id="_5">冒泡排序<a class="headerlink" href="#_5" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>冒泡排序是一种简单的排序算法，它重复地遍历需要排序的数组，每次比较相邻的两个元素，如果它们的顺序错误就交换它们。通过不断地交换相邻元素的位置，把大的元素交换到数组的末尾，最终实现整个数组的排序。</p>
<p>具体来说，冒泡排序的过程如下：</p>
<ol>
<li>从数组的第一个元素开始，依次比较相邻的两个元素，如果它们的顺序错误就交换它们的位置，把大的元素交换到数组的末尾。</li>
<li>继续遍历数组，依次比较相邻的两个元素，重复上述步骤，直到整个数组排序完成。</li>
</ol>
<p>可以参考该<a href="https://visualgo.net/en/sorting">动画网页</a>来理解冒泡排序的过程。</p>
<h2 id="_6">实验步骤<a class="headerlink" href="#_6" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_7">实验环境配置<a class="headerlink" href="#_7" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ol>
<li>
<p>安装<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>工具链<span><span class="heti-spacing"> </span>:</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gcc-riscv64-linux-gnu<span class="w"> </span>binutils-riscv64-linux-gnu
</code></pre></div></td></tr></table></div>
<p>然后运行<code>riscv64-linux-gnu-gcc --version</code>命令判断安装是否成功。</p>
</li>
<li>
<p>选择合适的位置安装<span class="heti-skip"><span class="heti-spacing"> </span>SPIKE<span class="heti-spacing"> </span></span>模拟器
   </p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>device-tree-compiler
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>git<span class="w"> </span>clone<span class="w"> </span>http://git.zju.edu.cn/zju-sys/sys1/riscv-isa-sim.git
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nb">cd</span><span class="w"> </span>riscv-isa-sim
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>../configure
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p>也可以直接使用我们的提供的安装脚本（需要管理员权限<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：
   </p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>device-tree-compiler
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>repo/riscv-isa-cosim
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nb">cd</span><span class="w"> </span>repo
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>make<span class="w"> </span>spike
</code></pre></div></td></tr></table></div>
<ol start="3">
<li>选择合适的位置（在<span class="heti-skip"><span class="heti-spacing"> </span>Linux<span class="heti-spacing"> </span></span>下，不要在<span class="heti-skip"><span class="heti-spacing"> </span>Windows<span class="heti-spacing"> </span></span>下安装）安装<span><span class="heti-spacing"> </span>RISC-V Proxy Kernel</span>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://git.zju.edu.cn/zju-sys/sys1/riscv-pk.git
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="nb">cd</span><span class="w"> </span>riscv-pk
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>../configure<span class="w"> </span>--host<span class="o">=</span>riscv64-linux-gnu
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</code></pre></div></td></tr></table></div></li>
</ol>
<p>也可以直接使用我们的提供的安装脚本（需要管理员权限<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：
   </p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>repo/riscv-pk
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="nb">cd</span><span class="w"> </span>repo
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>make<span class="w"> </span>pk
</code></pre></div></td></tr></table></div>
<ol start="4">
<li>
<p>进入到<code>sys1-sp24</code>文件夹拉取上游修改<span><span class="heti-spacing"> </span>:</span>
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>git<span class="w"> </span>pull
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>补全<code>src/lab5-1/simulate.sh</code>脚本中的<code>SPIKE_PATH</code>和<code>PK_PATH</code>变量为第二步中<span class="heti-skip"><span class="heti-spacing"> </span>spike<span class="heti-spacing"> </span></span>的路径和第三步中<span class="heti-skip"><span class="heti-spacing"> </span>pk<span class="heti-spacing"> </span></span>的路径（请确保<span class="heti-skip"><span class="heti-spacing"> </span>shell<span class="heti-spacing"> </span></span>脚本中等号左右没有空格<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。然后在<code>src/lab5-1</code>目录下执行<code>chmod +x simulate.sh</code>命令为<code>simulate.sh</code>脚本赋予执行权限。</p>
<blockquote>
<p>请不要复制<span class="heti-skip"><span class="heti-spacing"> </span>Windows<span class="heti-spacing"> </span></span>下的目录，得到目录的最直接方式是在对应目录下执行<span><span class="heti-spacing"> </span>pwd</span>，然后复制输出。</p>
</blockquote>
</li>
<li>
<p>在<code>src/lab5-1/</code>下有一个<span class="heti-skip"><span class="heti-spacing"> </span>Hello World<span class="heti-spacing"> </span></span>程序，文件名为<code>hello.c</code>，请在该文件夹下用以下命令编译，并测试是否能执行：
   </p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>hello.c<span class="w"> </span>-o<span class="w"> </span>hello<span class="w"> </span>-static
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>./simulate.sh<span class="w"> </span>hello
</code></pre></div></td></tr></table></div>
   预期输出：
<blockquote>
<p>hello, world!</p>
</blockquote>
</li>
</ol>
<h3 id="risc-v10">理解简单<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>程序<font color="Red"><span><span class="heti-spacing"> </span>10%</span></font><a class="headerlink" href="#risc-v10" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>在<code>src/lab5-1/acc.c</code>中，实现了一个简单的累加函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">acc</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">                </span><span class="n">res</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>src/lab5-1/acc_plain.s</code>是<code>src/lab5-1/acc.c</code>对应的一种汇编程序，由以下命令生成<span><span class="heti-spacing"> </span>:</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>-S<span class="w"> </span>acc.c<span class="w"> </span>-O0<span class="w"> </span>-o<span class="w"> </span>acc_plain.s
</code></pre></div></td></tr></table></div>
<p>请阅读<code>src/lab5-1/acc_plain.s</code>回答以下问题<span><span class="heti-spacing"> </span>:</span></p>
<ol>
<li><code>acc</code>是如何获得函数参数的，又是如何返回函数返回值的？<font color="Red">2%</font></li>
<li><code>acc</code>函数中<code>s0</code>寄存器的作用是什么，为什么在函数入口处需要执行<code>sd s0, 40(sp)</code>这条指令，而在这条指令之后的<code>addi s0, sp, 48</code>这条指令的目的是什么？<font color="Red">2%</font></li>
<li><code>acc</code>函数的栈帧<span class="heti-skip"><span class="heti-spacing"> </span>(stack frame)<span class="heti-spacing"> </span></span>的大小是多少？<font color="Red">1%</font></li>
<li><code>acc</code>函数栈帧中存储的值有哪些，它们分别存储在哪（相对于<code>sp</code>或<code>s0</code>来说<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>？<font color="Red">2%</font></li>
<li>请简要解释<code>acc</code>函数中的<span class="heti-skip"><span class="heti-spacing"> </span>for<span class="heti-spacing"> </span></span>循环是如何在汇编代码中实现的。<font color="Red">1%</font></li>
</ol>
<blockquote>
<p><span>Hint:<span class="heti-spacing"> </span></span><code>src/lab5-1/acc_plain.s</code>中出现的<code>j .L2</code>指令是<code>jal x0, .L2</code>的伪指令，请参考<a href="https://riscv.org/wp-content/uploads/2017/05/riscv-spec-v2.2.pdf"><span class="heti-skip"><span class="heti-spacing"> </span>The RISC-V Instruction Set Manual Volume I: User-Level ISA<span class="heti-spacing"> </span></span></a>第<span class="heti-skip"><span class="heti-spacing"> </span>110<span class="heti-spacing"> </span></span>页的<span><span class="heti-spacing"> </span>Table 20.2</span>。</p>
</blockquote>
<p><code>src/lab5-1/acc_opt.s</code>也是<code>src/lab5-1/acc.c</code>对应的一种汇编程序，它由另一种命令生成：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>-S<span class="w"> </span>acc.c<span class="w"> </span>-O2<span class="w"> </span>-o<span class="w"> </span>acc_opt.s
</code></pre></div></td></tr></table></div>
<p>请阅读<code>src/lab5-1/acc_opt.s</code>回答以下问题：</p>
<ol>
<li>请查阅资料简要描述编译选项<code>-O0</code>和<code>-O2</code>的区别。<font color="Red">1%</font></li>
<li>请简要讨论<code>src/lab5-1/acc_opt.s</code>与<code>src/lab5-1/acc_plain.s</code>的优劣。<font color="Red">1%</font></li>
</ol>
<h3 id="15">理解递归汇编程序<font color="Red"><span><span class="heti-spacing"> </span>15%</span></font><a class="headerlink" href="#15" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>在<code>src/lab5-1/factor.c</code>中，实现了一个通过递归求解阶乘的函数<code>factor</code>：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>src/lab5-1/factor_plain.s</code>是<code>src/lab5-1/factor.c</code>对应的一种汇编程序，由以下命令生成<span><span class="heti-spacing"> </span>:</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>-S<span class="w"> </span>factor.c<span class="w"> </span>-O0<span class="w"> </span>-o<span class="w"> </span>factor_plain.s
</code></pre></div></td></tr></table></div>
<p>请阅读<code>src/lab5-1/factor_plain.s</code>回答以下问题<span><span class="heti-spacing"> </span>:</span></p>
<ol>
<li>为什么<code>src/lab5-1/factor_plain.s</code>中<code>factor</code>函数的入口处需要执行<code>sd ra, 24(sp)</code>指令，而<code>src/lab5-1/acc_plain.s</code>中的<code>acc</code>函数并没有执行该指令？<font color="Red">2%</font></li>
<li>请解释在<code>call factor</code>前的<code>mv a0, a5</code>这条汇编指令的目的。<font color="Red">2%</font></li>
<li>请简要描述调用<code>factor(10)</code>时栈的变化情况；并回答栈最大内存占用是多少，发生在什么时候。<font color="Red">3%</font></li>
<li>假设栈的大小为<span><span class="heti-spacing"> </span>4KB</span>，请问<code>factor(n)</code>的参数<code>n</code>最大是多少？<font color="Red">2%</font></li>
</ol>
<blockquote>
<p><span>Hint:<span class="heti-spacing"> </span></span><code>mul a5, a4, a5</code>的含义是将<span class="heti-skip"><span class="heti-spacing"> </span>a4<span class="heti-spacing"> </span></span>寄存器和<span class="heti-skip"><span class="heti-spacing"> </span>a5<span class="heti-spacing"> </span></span>寄存器的内容相乘，并将结果放在<span class="heti-skip"><span class="heti-spacing"> </span>a5<span class="heti-spacing"> </span></span>寄存器中。<span>call<span class="heti-spacing"> </span></span>指令是一条伪指令，参考<a href="https://riscv.org/wp-content/uploads/2017/05/riscv-spec-v2.2.pdf"><span class="heti-skip"><span class="heti-spacing"> </span>The RISC-V Instruction Set Manual Volume I: User-Level ISA<span class="heti-spacing"> </span></span></a>第<span class="heti-skip"><span class="heti-spacing"> </span>110<span class="heti-spacing"> </span></span>页的<span><span class="heti-spacing"> </span>Table 20.2</span>。</p>
</blockquote>
<p><code>src/lab5-1/factor_opt.s</code>也是<code>src/lab5-1/factor.c</code>对应的一种汇编程序，它由另一种命令生成：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>-S<span class="w"> </span>factor.c<span class="w"> </span>-O2<span class="w"> </span>-o<span class="w"> </span>factor_opt.s
</code></pre></div></td></tr></table></div>
<p>请阅读<code>src/lab5-1/factor_opt.s</code>回答以下问题<span><span class="heti-spacing"> </span>:</span></p>
<ol>
<li>请简要描述<code>src/lab5-1/factor_opt.s</code>和<code>src/lab5-1/factor_plain.s</code>的区别。<font color="Red">2%</font></li>
<li>请从栈内存占用的角度比较<code>src/lab5-1/factor_opt.s</code>和<code>src/lab5-1/factor_plain.s</code>的优劣。<font color="Red">2%</font></li>
<li>请查阅<em>尾递归优化</em>的相关资料，解释编译器在生成<code>src/lab5-1/factor_opt.s</code>时做了什么优化，该优化的原理，以及什么时候能进行该优化。<font color="Red">2%</font></li>
</ol>
<h3 id="switch-5">理解<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>语句产生的跳转表<font color="Red"><span><span class="heti-spacing"> </span>5%</span></font><a class="headerlink" href="#switch-5" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>在<code>src/lab5-1/switch.c</code>中实现了一个简单的基于<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>语句的函数<code>switch_eq</code><span><span class="heti-spacing"> </span>:</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">switch_eg</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">21</span><span class="p">:</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">19</span><span class="p">;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">22</span><span class="p">:</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">24</span><span class="p">:</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">26</span><span class="p">:</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>src/lab5-1/switch.s</code>为该函数的汇编版本，由以下命令生成：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>-S<span class="w"> </span>switch.c<span class="w"> </span>-O2<span class="w"> </span>-o<span class="w"> </span>switch.s
</code></pre></div></td></tr></table></div>
<p>请阅读这两个文件并回答以下问题<span><span class="heti-spacing"> </span>:</span></p>
<ol>
<li>请简述在<code>src/lab5-1/switch.s</code>中是如何实现<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>语句的。<font color="Red">2%</font></li>
<li>请简述用跳转表实现<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>和用<span class="heti-skip"><span class="heti-spacing"> </span>if-else<span class="heti-spacing"> </span></span>实现<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>的优劣，在什么时候应该采用跳转表，在什么时候应该采用<span><span class="heti-spacing"> </span>if-else</span>。<font color="Red">3%</font></li>
</ol>
<blockquote>
<p><span>Hint: (1)<span class="heti-spacing"> </span></span><code>lla a4,.L4</code>的意思是将<span class="heti-skip"><span class="heti-spacing"> </span>.L4<span class="heti-spacing"> </span></span>这个<span class="heti-skip"><span class="heti-spacing"> </span>label<span class="heti-spacing"> </span></span>的地址加载到<code>a4</code>寄存器中<span class="heti-skip"><span class="heti-spacing"> </span>; (2)<span class="heti-spacing"> </span></span>跳转表部分可以参考<span><span class="heti-spacing"> </span>CSAPP</span>（深入理解计算机系统）第三章中关于<span class="heti-skip"><span class="heti-spacing"> </span>switch<span class="heti-spacing"> </span></span>语句的介绍，虽然<span class="heti-skip"><span class="heti-spacing"> </span>CSAPP<span class="heti-spacing"> </span></span>中的介绍是基于<span class="heti-skip"><span class="heti-spacing"> </span>x64<span class="heti-spacing"> </span></span>的，但是原理与<span class="heti-skip"><span class="heti-spacing"> </span>RISC-V<span class="heti-spacing"> </span></span>上是一致的。</p>
</blockquote>
<h3 id="20">设计冒泡排序的汇编代码<font color="Red"><span><span class="heti-spacing"> </span>20%</span></font><a class="headerlink" href="#20" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>请在<code>src/lab5-1/bubble_sort.s</code>中实现冒泡排序函数<code>bubble_sort</code>，其函数签名为<code>void bubble_sort(long long *arr, long long len)</code>，该函数将长度为<code>len</code>的数组<code>arr</code>在原地从小到大排序。</p>
<p>我们提供了<code>src/lab5-1/bubble_sort_test.c</code>文件用于测试你的实现是否正确，当你完成<code>bubble_sort.s</code>的编写后，在<code>src/lab5-1/</code>文件夹下用以下命令进行编译和测试：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>bubble_sort_test.c<span class="w"> </span>bubble_sort.s<span class="w"> </span>-o<span class="w"> </span>bubble_sort_test<span class="w"> </span>-static
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>./simulate.sh<span class="w"> </span>bubble_sort_test
</code></pre></div></td></tr></table></div>
<p>如果测试通过，会在终端显示<code>Sort Successfully</code>的提示信息，否则会输出错误提示。</p>
<p>该实验要求汇编代码要尽可能注释（最好每一行都要有注释<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。同时请不要先编写<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言程序再用编译器生成汇编代码，我们会比对你的代码与编译器生成的代码；并且考虑到考试中可能出现手写汇编的题目，请把这次实验的汇编代码编写当作一次练习。</p>
<h3 id="20_1">设计斐波那契数列的汇编代码<font color="Red"><span><span class="heti-spacing"> </span>20%</span></font><a class="headerlink" href="#20_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>请在<code>src/lab5-1/fibonacci.s</code>中实现求斐波那契数列第<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(n\)</span><span class="heti-spacing"> </span></span>项的函数，其函数签名为<code>long long fibonacci(long long n)</code>。其中<code>fibonacci(0) = fibonacci(1) = 1</code><span><span class="heti-spacing"> </span>;</span> <code>fibonacci(n) = fibonacci(n-1) + fibonacci(n-2), n &gt;= 2</code>。要求该函数用递归实现，即使你知道可以用动态规划实现，也请用最简单的递归实现。</p>
<p>我们也提供了<code>src/lab5-1/fibonacci_test.c</code>文件用于测试你的实现是否正确，当你完成<code>fibonacci.s</code>的编写后，在<code>src/lab5-1/</code>文件夹下用以下命令进行编译和测试：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a>riscv64-linux-gnu-gcc<span class="w"> </span>fibonacci_test.c<span class="w"> </span>fibonacci.s<span class="w"> </span>-o<span class="w"> </span>fibonacci_test<span class="w"> </span>-static
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>./simulate.sh<span class="w"> </span>fibonacci_test
</code></pre></div></td></tr></table></div>
<p>同样的，该实验也要求汇编代码要尽可能注释，并且禁止提交由<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言程序编译生成的汇编代码。</p>
<h2 id="70">实验报告<font color="Red"><span><span class="heti-spacing"> </span>70%</span></font><a class="headerlink" href="#70" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>lab5<span class="heti-spacing"> </span></span>汇编实验无需验收，故分数完全由报告组成，其中<span><span class="heti-spacing"> </span>lab5-1</span>（本次）占实验分数的<font color="Red"><span><span class="heti-spacing"> </span>70%</span></font>，<span>lab5-2<span class="heti-spacing"> </span></span>占<font color="Red"><span><span class="heti-spacing"> </span>30%</span></font>。
请同学们按要求提交实验报告和源代码文件：</p>
<ol>
<li>实验报告中需包括你对<span class="heti-skip"><span class="heti-spacing"> </span>4.1<span class="heti-spacing"> </span></span>到<span class="heti-skip"><span class="heti-spacing"> </span>4.3<span class="heti-spacing"> </span></span>节中问题的回答，以及解释<span class="heti-skip"><span class="heti-spacing"> </span>4.4<span class="heti-spacing"> </span></span>节与<span class="heti-skip"><span class="heti-spacing"> </span>4.5<span class="heti-spacing"> </span></span>节你编写的汇编代码。</li>
<li>源代码文件需要包含<code>bubble_sort.s</code>和<code>fibonacci.s</code>两个文件。</li>
</ol>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 附录：SystemVerilog 高级语法" class="md-footer__link md-footer__link--prev" href="../lab4-1-appendix/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                附录：SystemVerilog 高级语法
              </div>
</div>
</a>
<a aria-label="Next: 第二部分" class="md-footer__link md-footer__link--next" href="../lab5-2/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                第二部分
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "navigation.tracking", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
<script src="https://cdn.tonycrane.cc/utils/katex.min.js"></script>
<script src="../js/katex.js"></script>
</body>
</html>