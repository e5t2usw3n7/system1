<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="http://zju-sys.pages.zjusct.io/sys1/sys1-sp24/lab2-1/" rel="canonical"/>
<link href="../lab1-2/" rel="prev"/>
<link href="../lab2-1-appendix/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.0, mkdocs-material-9.5.34" name="generator"/>
<title>第一部分 - 浙江大学24年春夏系统一实验</title>
<link href="../assets/stylesheets/main.35f28582.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"JetBrains Mono";--md-code-font:"JetBrains Mono"}</style>
<link href="../css/heti.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/utils/katex.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:500,500i,600,600i&amp;display=fallback" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#2-1-64">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="浙江大学24年春夏系统一实验" class="md-header__button md-logo" data-md-component="logo" href=".." title="浙江大学24年春夏系统一实验">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            浙江大学24年春夏系统一实验
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              第一部分
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://git.zju.edu.cn/zju-sys/sys1/sys1-sp24" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    zju-sys/sys1/sys1-sp24
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="浙江大学24年春夏系统一实验" class="md-nav__button md-logo" data-md-component="logo" href=".." title="浙江大学24年春夏系统一实验">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    浙江大学24年春夏系统一实验
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://git.zju.edu.cn/zju-sys/sys1/sys1-sp24" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    zju-sys/sys1/sys1-sp24
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    首页
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    实验指导零
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            实验指导零
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab0-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab0-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab0-2-appendix/">
<span class="md-ellipsis">
    附录：verilog 与电路
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    实验指导一
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            实验指导一
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab1-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab1-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    实验指导二
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            实验指导二
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    第一部分
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      实验目的
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      实验环境
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      背景知识
    </span>
</a>
<nav aria-label="背景知识" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-bit">
<span class="md-ellipsis">
      1-bit 全加器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      行波进位加法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      超前进位加法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      全加减法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      仿真测试
    </span>
</a>
<nav aria-label="仿真测试" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      随机测试
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#difftest">
<span class="md-ellipsis">
      差分测试 difftest
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      实验步骤
    </span>
</a>
<nav aria-label="实验步骤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      实验前准备
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      设计行波进位加法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      仿真验证
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      下板验证
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#100">
<span class="md-ellipsis">
      实验报告 100%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      代码提交
    </span>
</a>
<nav aria-label="代码提交" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#100_1">
<span class="md-ellipsis">
      验收检查点 100%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      提交文件
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab2-1-appendix/">
<span class="md-ellipsis">
    附录：参数式编程
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    实验指导三
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            实验指导三
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-3/">
<span class="md-ellipsis">
    第三部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-1-appendix/">
<span class="md-ellipsis">
    附录：reg 与时序电路
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab3-3-appendix/">
<span class="md-ellipsis">
    附录：阻塞赋值
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    实验指导四
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            实验指导四
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab4-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab4-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab4-1-appendix/">
<span class="md-ellipsis">
    附录：SystemVerilog 高级语法
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    实验指导五
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            实验指导五
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab5-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab5-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    实验指导 project
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            实验指导 project
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../project-1/">
<span class="md-ellipsis">
    第一部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-2/">
<span class="md-ellipsis">
    第二部分
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-bonus/">
<span class="md-ellipsis">
    Bonus
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-2-appendix/">
<span class="md-ellipsis">
    附录：处理器差分测试
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup/">
<span class="md-ellipsis">
    环境配置
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../issue/">
<span class="md-ellipsis">
    提交提问
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pull/">
<span class="md-ellipsis">
    提交修改
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      实验目的
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      实验环境
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      背景知识
    </span>
</a>
<nav aria-label="背景知识" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-bit">
<span class="md-ellipsis">
      1-bit 全加器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      行波进位加法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      超前进位加法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      全加减法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      仿真测试
    </span>
</a>
<nav aria-label="仿真测试" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      随机测试
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#difftest">
<span class="md-ellipsis">
      差分测试 difftest
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      实验步骤
    </span>
</a>
<nav aria-label="实验步骤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      实验前准备
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      设计行波进位加法器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      仿真验证
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      下板验证
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#100">
<span class="md-ellipsis">
      实验报告 100%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      代码提交
    </span>
</a>
<nav aria-label="代码提交" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#100_1">
<span class="md-ellipsis">
      验收检查点 100%
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      提交文件
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://git.zju.edu.cn/zju-sys/sys1/sys1-sp24/-/blob/master/docs/lab2-1.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<h1 id="2-1-64">实验<span class="heti-skip"><span class="heti-spacing"> </span>2-1: 64<span class="heti-spacing"> </span></span>位全加减法器的实现<a class="headerlink" href="#2-1-64" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<h2 id="_1">实验目的<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>强化使用<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>语言进行电路设计的方法</li>
<li>掌握行波进位加法器和全加减法器的原理</li>
<li>设计实现<span class="heti-skip"><span class="heti-spacing"> </span>64 bit<span class="heti-spacing"> </span></span>超前进位加法器</li>
</ul>
<h2 id="_2">实验环境<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>操作系统：Windows 10+ 22H2，Ubuntu 22.04+</li>
<li>VHDL：Verilog</li>
</ul>
<h2 id="_3">背景知识<a class="headerlink" href="#_3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="1-bit"><span>1-bit<span class="heti-spacing"> </span></span>全加器<a class="headerlink" href="#1-bit" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>全加器的真值表和输入输出如下：
    </p><center> <br/>
<img alt="" src="../img/lab2-1/0.png" width="350"/>
</center>
<p>大家可以自由使用之前学习的<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>语法设计逻辑电路，填写 <code>src/lab2-1/submit/adder.v</code> 的代码。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span>
<span class="normal"><a href="#__codelineno-0-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">module</span><span class="w"> </span><span class="n">Adder</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w">        </span><span class="c1">//被加数</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">        </span><span class="c1">//加数</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">c_in</span><span class="p">,</span><span class="w">     </span><span class="c1">//低位加法运算的进位 carry</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w">       </span><span class="c1">//和 summary</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="n">c_out</span><span class="w">    </span><span class="c1">//进位 carry</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">);</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="c1">//fill your code here</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">endmodule</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<h3 id="_4">行波进位加法器<a class="headerlink" href="#_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>我们可以用<span class="heti-skip"><span class="heti-spacing"> </span>1-bit<span class="heti-spacing"> </span></span>的全加器为基础实现一个<span class="heti-skip"><span class="heti-spacing"> </span>32-bit<span class="heti-spacing"> </span></span>全加器，只要将低位全加器的 <code>c_out</code> 进位作为高位全加器的 <code>c_in</code> 即可。因为高位计算的 <code>carry</code> 由低位计算得到的 <code>carry</code> 依次传播得到，<code>carry</code> 像波浪一样在全加器中从低位向高位传播，所以称之为行波进位加法器 <strong>ripple-carry adder</strong>。
    </p><center> <br/>
<img alt="" src="../img/lab2-1/1.png" width="350"/>
</center>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">module</span><span class="w"> </span><span class="n">Adder32</span><span class="p">(</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">c_in</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="n">c_out</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="p">);</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">32</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="k">assign</span><span class="w"> </span><span class="n">c</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="o">=</span><span class="n">c_in</span><span class="p">;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="n">Adder</span><span class="w"> </span><span class="n">adder0</span><span class="p">(.</span><span class="n">a</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">]),.</span><span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">]),.</span><span class="n">c_in</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">0</span><span class="p">]),.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mh">0</span><span class="p">]),.</span><span class="n">c_out</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">1</span><span class="p">]));</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="n">Adder</span><span class="w"> </span><span class="n">adder1</span><span class="p">(.</span><span class="n">a</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">]),.</span><span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">]),.</span><span class="n">c_in</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">1</span><span class="p">]),.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mh">1</span><span class="p">]),.</span><span class="n">c_out</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">2</span><span class="p">]));</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="n">Adder</span><span class="w"> </span><span class="n">adder2</span><span class="p">(.</span><span class="n">a</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">]),.</span><span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">]),.</span><span class="n">c_in</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">2</span><span class="p">]),.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mh">2</span><span class="p">]),.</span><span class="n">c_out</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">3</span><span class="p">]));</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="n">Adder</span><span class="w"> </span><span class="n">adder31</span><span class="p">(.</span><span class="n">a</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">31</span><span class="p">]),.</span><span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mh">31</span><span class="p">]),.</span><span class="n">c_in</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">31</span><span class="p">]),.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mh">31</span><span class="p">]),</span><span class="n">c_out</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mh">32</span><span class="p">]));</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="k">endmodule</span>
</code></pre></div></td></tr></table></div>
<p>但是现在我们要求这个全加器模块可以是任意长度的，请大家善用 <code>generate</code> 语句和 <code>for</code> 循环自行实现 <code>src/lab2-1/submit/adders.v</code> 模块。相关语法可见<a href="../lab2-1-appendix/"><span><span class="heti-spacing"> </span>Lab2-1 Appendix</span></a>。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">module</span><span class="w"> </span><span class="n">Adders</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="n">LENGTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span><span class="w">   </span><span class="c1">// 参数，全加器的长度</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="p">)(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="n">LENGTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w">   </span><span class="c1">// 被加数</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="n">LENGTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">   </span><span class="c1">// 加数</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">c_in</span><span class="p">,</span><span class="w">             </span><span class="c1">// 低位进位</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="n">LENGTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w">  </span><span class="c1">// 和</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="n">c_out</span><span class="w">            </span><span class="c1">// 高位进位</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="p">);</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="k">endmodule</span>
</code></pre></div></td></tr></table></div>
<h3 id="_5">超前进位加法器<a class="headerlink" href="#_5" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>ripple-carry adder<span class="heti-spacing"> </span></span>虽然结构简单，但随之而来的存在<strong>缺点</strong>，为了解决<span class="heti-skip"><span class="heti-spacing"> </span>ripple-carry adder<span class="heti-spacing"> </span></span>的问题，工程师们设计了一种 <strong>carry-lookahead adder</strong>（超前进位加法器<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>回到<span class="heti-skip"><span class="heti-spacing"> </span>1-bit<span class="heti-spacing"> </span></span>全加器中，为了了解<span class="heti-skip"><span class="heti-spacing"> </span>carry-lookahead adder<span class="heti-spacing"> </span></span>的思路，我们需要增加对两个信号描述：<code>P</code>，<code>G</code>.
    </p><center>
<img alt="" src="../img/lab2-1/2.png" width="400"/>
</center>
<p>可以得到下面的公式<span><span class="heti-spacing"> </span>:</span> </p>
<p><strong>NOTE:</strong>公式中的<strong>加号</strong>是真正的加号，实际上可以理解为<strong>异或</strong>。</p>
<div class="arithmatex">\[
\begin{aligned}
c_{i+1} &amp;= G_i + P_i \cdot c_i\\
s_i &amp;= P_i \oplus c_i\\
G_i &amp;=a_i\cdot b_i\\
P_i &amp;=a_i\oplus b_i
\end{aligned}
\]</div>
<p>那么对于一个<span class="heti-skip"><span class="heti-spacing"> </span>4-bit<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>carry-lookahead adder</span>（如图）
    </p><center>
<img alt="" src="../img/lab2-1/4.png" width="400"/>
</center>
<p>通过对信号分析可以得到：</p>
<div class="arithmatex">\[
\begin{aligned}
c_1 &amp; = G_0 + P_0 \cdot c_0\\
c_2 &amp; = G_1 + P_1 \cdot G_0 + P_1\cdot P_0 \cdot c_0\\
c_3 &amp; = G_2 + P_2 \cdot G_1 + P_2\cdot P_1 \cdot G_0 + P_2\cdot P_1 \cdot P_0 \cdot c_0\\
c_4 &amp; = G_3 + P_3 \cdot G_2 + P_3\cdot P_2 \cdot G_1 + P_3\cdot P_2 \cdot P_1 \cdot G_0 + P_3\cdot P_2 \cdot P_1 \cdot P_0 \cdot c_0\\ 
\end{aligned}
\]</div>
<p>那么一个<span class="heti-skip"><span class="heti-spacing"> </span>4-bit<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>carry-lookahead<span class="heti-spacing"> </span></span>的加法器就已经设计完成了。对于<span class="heti-skip"><span class="heti-spacing"> </span>32-bit<span class="heti-spacing"> </span></span>的加法器，我们也只需要用同样的思路做超前进位即可。 </p>
<p>对于<span class="heti-skip"><span class="heti-spacing"> </span>16-bit<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>carry-lookahead<span class="heti-spacing"> </span></span>的加法器，可以将<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>4-bit carry-lookahead<span class="heti-spacing"> </span></span>加法器接在一个<strong>二级<span><span class="heti-spacing"> </span>carry-lookahead</span></strong> 逻辑上。那么对于一个<span><span class="heti-spacing"> </span>4-bit carry-lookahead</span>，它的<span class="heti-skip"><span class="heti-spacing"> </span>P<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>G<span class="heti-spacing"> </span></span>信号分别是：</p>
<div class="arithmatex">\[
\begin{aligned}
P &amp; = P_3 \cdot P_2 \cdot P_1 \cdot P_0\\
G &amp; = G_3 + P_3 \cdot G_2 + P_3\cdot P_2 \cdot G_1 + P_3\cdot P_2 \cdot P_1 \cdot G_0
\end{aligned}
\]</div>
<p>其对应的电路图如下：
    </p><center>
<img alt="" src="../img/lab2-1/7.png" width="400"/>
</center>
<p>最后使用 <strong>ripple-carry</strong> 方法将<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>16-bit carry-lookahead<span class="heti-spacing"> </span></span>加法器串联成一个<span class="heti-skip"><span class="heti-spacing"> </span>32-bit<span class="heti-spacing"> </span></span>加法器即可。</p>
<h3 id="_6">全加减法器<a class="headerlink" href="#_6" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>N<span class="heti-spacing"> </span></span>位二进制的加减法不是纯粹的加减法，而是<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(\mod 2^N\)</span><span class="heti-spacing"> </span></span>意义下的加法，因此：</p>
<div class="arithmatex">\[
\begin{aligned}
a + b &amp; =  a + (b\oplus \underbrace{00\ldots0}_N)  \\
a - b &amp; = a + (-b) \equiv a + (((2^N-1) - b) + 1) = a + (b\oplus \underbrace{11\ldots1}_N) + 1 
\end{aligned}
\]</div>
<p>如果我们用 <code>do_sub = 1</code> 表示做减法，用 <code>do_sub = 0</code> 表示做加法，则可以将加法和减法合并为如下逻辑表达式<heti-adjacent class="heti-adjacent-half">：</heti-adjacent>（这里用<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(x\)</span><span class="heti-spacing"> </span></span>代替 <code>do_sub</code>）</p>
<div class="arithmatex">\[
a + (b\oplus\underbrace{cc\ldots c}_N) + c
\]</div>
<p>所以可以得到如下的电路图：</p>
<p></p><center>
<p><img alt="add-sub" src="../img/lab2-1/add-sub.png"/></p>
<p></p></center>
<p>我们的<span class="heti-skip"><span class="heti-spacing"> </span>adders<span class="heti-spacing"> </span></span>模块可以实现逻辑三目表达式 <code>a + b + c</code>，因此请使用<strong>异或操作</strong>和<span class="heti-skip"><span class="heti-spacing"> </span>adders<span class="heti-spacing"> </span></span>模块相结合，补全 <code>src/lab2-1/submit/add_subs.v</code> 实现全加减法器。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">module</span><span class="w"> </span><span class="n">AddSubers</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="n">LENGTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span><span class="w">   </span><span class="c1">//全加减法器的宽度</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="p">)(</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="n">LENGTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w">   </span><span class="c1">//被加数/被减数</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="n">LENGTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">   </span><span class="c1">//加数/减数</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">do_sub</span><span class="p">,</span><span class="w">           </span><span class="c1">//0表示加法，1表示减法</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="n">LENGTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w">  </span><span class="c1">//和/差</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="n">c</span><span class="w">                </span><span class="c1">//进位/借位</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="p">);</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="c1">//fill your code here</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="k">endmodule</span>
</code></pre></div></td></tr></table></div>
<h3 id="_7">仿真测试<a class="headerlink" href="#_7" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_8">随机测试<a class="headerlink" href="#_8" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>之前实验我们的<span class="heti-skip"><span class="heti-spacing"> </span>testbench<span class="heti-spacing"> </span></span>的测试样例都是遍历所有的输入组合，然后检查输出是否一一对应，这样可以最大程度地确保逻辑电路的正确性。但是对于<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位全加减法器甚至<span class="heti-skip"><span class="heti-spacing"> </span>64<span class="heti-spacing"> </span></span>位全加减法器，其输入组合用<span class="heti-skip"><span class="heti-spacing"> </span>2^65<span class="heti-spacing"> </span></span>甚至<span class="heti-skip"><span class="heti-spacing"> </span>2^129<span class="heti-spacing"> </span></span>种，遍历所有的输入组合是不现实的，所以可以考虑随机产生输入进行测试。</p>
<p><span>Verilog<span class="heti-spacing"> </span></span>提供了函数 <code>$random()</code> 来提供宽度为<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位的随机数，如果对随机数的位宽有要求可以对 <code>$random()</code> 的输出做索引或者拼接。切记，<code>$random()</code> 只能用于 <code>initial</code> 块的仿真激励，并不会产生真实的电路逻辑。</p>
<h4 id="difftest">差分测试<span><span class="heti-spacing"> </span>difftest</span><a class="headerlink" href="#difftest" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>通过观看仿真波形，然后手工比对输入输出的对应关系是否正确无疑是低效的，特别是当真值表很难直接推导得到的时候。此时可以实现一个待测试电路的对拍器，这个对拍器电路等价于代码测试电路，然后为他们提供一样的输入，在比较二者的输出，如果二者的输出保持一致则通过测试，反之则测试失败。</p>
<p>对拍器电路可以用<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>语言、<span>IP<span class="heti-spacing"> </span></span>核甚至<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言编写，且因为只在仿真中使用，设计的时候往往只需要考虑其逻辑正确性，而无需关心是否能生成真正高效运行的电路。</p>
<p><code>src/lab2-1/sim/judge.v</code> 是用于检测 <code>add_subs.v</code> 正确性的对拍器，这里直接用<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>的 <code>+/-</code> 算子实现加法器和减法器，用 <code>==</code> 算子实现比较器，检测最终结果是否正确。</p>
<p><span>Verilog<span class="heti-spacing"> </span></span>提供了一系列算术运算算子包括 <code>+, -, *, /, %, &lt;&lt;, &gt;&gt;, &gt;&gt;&gt;, &gt;, &lt;, ==, !=, &lt;=, =&gt;</code> 等分别对应加法器、减法器、乘法器、除法器、模运算器、移位电路、比较电路等。实际上使用这些算子除了在电路设计上更高效以外，综合的时候<span class="heti-skip"><span class="heti-spacing"> </span>Vivado<span class="heti-spacing"> </span></span>也会充分使用<span class="heti-skip"><span class="heti-spacing"> </span>FPGA<span class="heti-spacing"> </span></span>上已有的专用电路搭建这些电路，比我们手动用逻辑门搭建的电路更加高效。</p>
<p>大家在后续设计复杂电路的时候可以充分使用这些算子，但是现阶段<strong>请继续用门电路搭建这些运算电路</strong>，以期对底层电路有一个具体清晰的认识。</p>
<details>
<summary><span>function<span class="heti-spacing"> </span></span>语法和 <code>judge.v</code> 工作原理</summary>
<p>我们在仿真的时候可能需要执行一些简单的函数计算，所以<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>提供了<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>语法来实现类似<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>函数的功能。我们以下面这段代码为例介绍一下<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>函数的语法。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">function</span><span class="w"> </span><span class="k">unsigned</span><span class="w"> </span><span class="n">add_judge</span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">do_sub</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">c</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="p">);</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s_result</span><span class="p">;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">c_result</span><span class="p">;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="k">begin</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">do_sub</span><span class="p">)</span><span class="k">begin</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">            </span><span class="p">{</span><span class="n">c_result</span><span class="p">,</span><span class="n">s_result</span><span class="p">}</span><span class="o">=</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">,</span><span class="n">a</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b1</span><span class="p">,</span><span class="n">b</span><span class="p">};</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">            </span><span class="p">{</span><span class="n">c_result</span><span class="p">,</span><span class="n">s_result</span><span class="p">}</span><span class="o">=</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">,</span><span class="n">a</span><span class="p">}</span><span class="o">+</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">,</span><span class="n">b</span><span class="p">};</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">        </span><span class="n">add_judge</span><span class="o">=</span><span class="p">(</span><span class="n">c_result</span><span class="o">==</span><span class="n">c</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">s_result</span><span class="o">==</span><span class="n">s</span><span class="p">);</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="k">endfunction</span>
</code></pre></div></td></tr></table></div>
<p><span>function<span class="heti-spacing"> </span></span>函数被<code>function ... endfunction</code>关键字包围。<span>unsigned<span class="heti-spacing"> </span></span>是函数的返回类型，必须是一个<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>的变量类型，且和<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>函数一样，<span>function<span class="heti-spacing"> </span></span>函数只能有一个返回值。<span>Verilog<span class="heti-spacing"> </span></span>的变量类型由位宽和符号两部分组成，例如<code>[1:0] unsigned</code>表示类型为位宽为<span class="heti-skip"><span class="heti-spacing"> </span>2 bit<span class="heti-spacing"> </span></span>的无符号数类型。如果位宽缺省默认是一位，如果符号类型缺省，默认是<span class="heti-skip"><span class="heti-spacing"> </span>unsigned<span class="heti-spacing"> </span></span>类型，所以我们平时定义的<span><span class="heti-spacing"> </span>wire</span>、<span>reg<span class="heti-spacing"> </span></span>其实都是<span class="heti-skip"><span class="heti-spacing"> </span>unsigned<span class="heti-spacing"> </span></span>类型。<span>add_judge<span class="heti-spacing"> </span></span>是函数的名字。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">function</span><span class="w"> </span><span class="k">unsigned</span><span class="w"> </span><span class="n">add_judge</span><span class="p">(</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="p">);</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="k">endfunction</span>
</code></pre></div></td></tr></table></div>
<p><span>function<span class="heti-spacing"> </span></span>的参数列表，和<span class="heti-skip"><span class="heti-spacing"> </span>module<span class="heti-spacing"> </span></span>的参数列表结构相一致，格式为<code>input 位宽 数据类型 参数名</code>但是因为<span class="heti-skip"><span class="heti-spacing"> </span>fuction<span class="heti-spacing"> </span></span>时传入参数做计算的，所以参数只能是<span class="heti-skip"><span class="heti-spacing"> </span>input<span class="heti-spacing"> </span></span>类型，不存在<span><span class="heti-spacing"> </span>output</span>。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">do_sub</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">c</span>
</code></pre></div></td></tr></table></div>
<p>最后是<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>的函数体定义。我们可以用传入的参数直接作为变量加以计算，此外<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>自带一个与函数名同名、与返回类型同类型的变量<span><span class="heti-spacing"> </span>add_judge</span>，这个函数最后被赋值的结果，就是该函数的返回结果。如果我们需要额外的变量可以在函数体开头手动定义，格式为<code>reg 变量类型 变量名</code>，这里的<span class="heti-skip"><span class="heti-spacing"> </span>reg<span class="heti-spacing"> </span></span>和寄存器没有关系，仅仅只是一个函数的运算变量而已。<span>function<span class="heti-spacing"> </span></span>不存在<span class="heti-skip"><span class="heti-spacing"> </span>wire<span class="heti-spacing"> </span></span>变量，这不是电路，没有导线。 </p>
<p>函数体只能包含一句运算语句。如果我们需要包含多句变量语句，需要用<code>begin ... end</code>包裹起来，<code>begin ... end</code>语句块被当作单一语句。内部可以有<span class="heti-skip"><span class="heti-spacing"> </span>for<span class="heti-spacing"> </span></span>语句、<span>if-else<span class="heti-spacing"> </span></span>语句、<span>case<span class="heti-spacing"> </span></span>语句、<span>while<span class="heti-spacing"> </span></span>语句、算数运算语句等，这里的执行逻辑和编写方式和<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言高度一致。对于综合的程序我们需要把他们转化为对应的电路连接，但是对于仅用于仿真的语句只需要当作且只能当作<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>程序看待。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s_result</span><span class="p">;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">c_result</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="k">begin</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">do_sub</span><span class="p">)</span><span class="k">begin</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">            </span><span class="p">{</span><span class="n">c_result</span><span class="p">,</span><span class="n">s_result</span><span class="p">}</span><span class="o">=</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">,</span><span class="n">a</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b1</span><span class="p">,</span><span class="n">b</span><span class="p">};</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">            </span><span class="p">{</span><span class="n">c_result</span><span class="p">,</span><span class="n">s_result</span><span class="p">}</span><span class="o">=</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">,</span><span class="n">a</span><span class="p">}</span><span class="o">+</span><span class="p">{</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">,</span><span class="n">b</span><span class="p">};</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">        </span><span class="n">add_judge</span><span class="o">=</span><span class="p">(</span><span class="n">c_result</span><span class="o">==</span><span class="n">c</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">s_result</span><span class="o">==</span><span class="n">s</span><span class="p">);</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<p>因为<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>函数是当作<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>函数做运算的，所以它不能包含那些电路特有的语法，比如<span class="heti-skip"><span class="heti-spacing"> </span>always<span class="heti-spacing"> </span></span>块触发、<span>wire<span class="heti-spacing"> </span></span>变量、<span>#5<span class="heti-spacing"> </span></span>延时语句、时序电路、<span>initial<span class="heti-spacing"> </span></span>初始化等等。</p>
<p>之后<span class="heti-skip"><span class="heti-spacing"> </span>judge<span class="heti-spacing"> </span></span>模块使用<span class="heti-skip"><span class="heti-spacing"> </span>add_judge<span class="heti-spacing"> </span></span>函数进行正确性的检验。该函数可以像<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>函数一样调用，传入的参数可以是<span class="heti-skip"><span class="heti-spacing"> </span>wire<span class="heti-spacing"> </span></span>的输出，也可以是参数、立即数，函数的输出可以被当作参数、立即数给其他的<span><span class="heti-spacing"> </span>wire</span>、<span>reg<span class="heti-spacing"> </span></span>变量赋值。需要注意的是<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>是仅用于仿真的语法，它的执行计算是没有电路实验开销的，无论内部的内容多复杂都可以直接得到最终结果；因为<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>仅用于仿真，所以不能将<span class="heti-skip"><span class="heti-spacing"> </span>function<span class="heti-spacing"> </span></span>代替复杂电路逻辑用于电路综合，他无法生成有意义的电路。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">module</span><span class="w"> </span><span class="n">Judge</span><span class="p">(</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="p">,</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">do_sub</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="k">input</span><span class="w"> </span><span class="n">c</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="n">error</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">);</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="k">assign</span><span class="w"> </span><span class="n">error</span><span class="o">=~</span><span class="n">add_judge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">do_sub</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="k">endmodule</span><span class="w"> </span><span class="c1">//Judge</span>
</code></pre></div></td></tr></table></div>
<p>如果<span class="heti-skip"><span class="heti-spacing"> </span>Judge<span class="heti-spacing"> </span></span>模块内部<span class="heti-skip"><span class="heti-spacing"> </span>add_judge<span class="heti-spacing"> </span></span>函数计算表明存在错误，则每个周期<span class="heti-skip"><span class="heti-spacing"> </span>always<span class="heti-spacing"> </span></span>块被触发的时候，就会检查<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>是不是等于<span><span class="heti-spacing"> </span>1</span>，如果等于<span><span class="heti-spacing"> </span>1</span>，就会用内置的<span class="heti-skip"><span class="heti-spacing"> </span>$display<span class="heti-spacing"> </span></span>函数输出错误信息。在仿真的时候<span class="heti-skip"><span class="heti-spacing"> </span>always<span class="heti-spacing"> </span></span>块内部的描述的内容是会被按照<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言那样执行的，比如<span class="heti-skip"><span class="heti-spacing"> </span>if-else<span class="heti-spacing"> </span></span>只执行<span class="heti-skip"><span class="heti-spacing"> </span>if<span class="heti-spacing"> </span></span>块或者只执行<span class="heti-skip"><span class="heti-spacing"> </span>else<span class="heti-spacing"> </span></span>块，但是当转换电路的时候<span class="heti-skip"><span class="heti-spacing"> </span>if<span class="heti-spacing"> </span></span>对应的电路和<span class="heti-skip"><span class="heti-spacing"> </span>else<span class="heti-spacing"> </span></span>对应的电路总是同时工作的，理清仿真和综合的区别有利于加深对<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>电路描述语言和仿真语言的理解。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="n">Judge</span><span class="w"> </span><span class="n">judge</span><span class="p">(</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">        </span><span class="p">.</span><span class="n">a</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">        </span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">        </span><span class="p">.</span><span class="n">do_sub</span><span class="p">(</span><span class="n">do_sub</span><span class="p">),</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">        </span><span class="p">.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">        </span><span class="p">.</span><span class="n">c</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">        </span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">    </span><span class="k">always</span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="k">begin</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="k">begin</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">            </span><span class="nb">$display</span><span class="p">(</span><span class="s">"a=%d, b=%d, do_sub=%d, s=%d, c=%d, error"</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">do_sub</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">);</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">    </span><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<p><code>$display()</code> 函数的用法和<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言的 <code>printf()</code> 类似，可以接受参数作为输入，也可以接受电路输出作为输入。但是切记，<code>$display()</code> 这类函数只能用于 <code>always</code> 块和 <code>initial</code> 块内。</p>
</details>
<details>
<summary><code>testbench.v</code> 仿真代码原理</summary>
<p>下面的代码来自 <code>src/lab2-1/sim/testbench.v</code>，用于我们进行仿真测试，包括差分测试<span><span class="heti-spacing"> </span>difftest</span>。</p>
<p>这里的 <code>always</code> 块很明显是用于仿真的，它并不会生成真实的电路，大家可以把它当作一个<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言的<span class="heti-skip"><span class="heti-spacing"> </span>if-else<span class="heti-spacing"> </span></span>逻辑来看待。生成电路的代码以电路的视角看待，用于仿真的代码以<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>逻辑的视角看待即可。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="w">        </span><span class="kt">reg</span><span class="w"> </span><span class="n">clk</span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">        </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">            </span><span class="n">clk</span><span class="o">=</span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="k">always</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">            </span><span class="n">clk</span><span class="o">=~</span><span class="n">clk</span><span class="p">;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">            </span><span class="p">#</span><span class="mh">5</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">        </span><span class="c1">// 提供一个时钟周期为 10 单位时间的时钟</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">        </span><span class="kt">wire</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">        </span><span class="n">Judge</span><span class="w"> </span><span class="n">judge</span><span class="p">(</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">            </span><span class="p">.</span><span class="n">a</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">            </span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">            </span><span class="p">.</span><span class="n">do_sub</span><span class="p">(</span><span class="n">do_sub</span><span class="p">),</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">            </span><span class="p">.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">            </span><span class="p">.</span><span class="n">c</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">            </span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">        </span><span class="c1">// 对拍器检查 add_subs 的输入输出是否正确</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w">        </span><span class="k">always</span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="k">begin</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="k">begin</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">            </span><span class="c1">// 每个时钟周期检查一次 error 的值，如果检查出来结果是错的</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">                </span><span class="nb">$display</span><span class="p">(</span><span class="s">"a=%d, b=%d, do_sub=%d, s=%d, c=%d, error"</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">do_sub</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">);</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">                </span><span class="c1">// display 函数输出错误的信息</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">            </span><span class="k">end</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">        </span><span class="k">end</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="_9">实验步骤<a class="headerlink" href="#_9" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_10">实验前准备<a class="headerlink" href="#_10" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>与之前的<span class="heti-skip"><span class="heti-spacing"> </span>lab<span class="heti-spacing"> </span></span>相同，启动安装在你电脑中的<span class="heti-skip"><span class="heti-spacing"> </span>Ubuntu 22.04<span class="heti-spacing"> </span></span>环境（ <span>WSL<span class="heti-spacing"> </span></span>或虚拟机<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，随后通过 <code>cd</code> 移动到 <code>sys1-sp24</code> 目录下，执行下面的命令：
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>git<span class="w"> </span>pull
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="nb">cd</span><span class="w"> </span>repo/sys-project
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>git<span class="w"> </span>pull
</code></pre></div></td></tr></table></div>
<p>这个命令将仓库更新到最新状态，你可以看到 <code>src/</code> 目录下出现 <code>lab2-1/</code> 目录。</p>
<h3 id="_11">设计行波进位加法器<a class="headerlink" href="#_11" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>仔细阅读指导，编写 <code>src/lab2-1/submit</code> 文件夹下的文件<code>adder.v</code><span><span class="heti-spacing"> </span>,</span><code>adders.v</code><span><span class="heti-spacing"> </span>,</span> <code>add_subs.v</code>，设计<strong>可配置宽度</strong>的行波进位加法器。<strong>不可以</strong>直接使用 <code>+/-</code> 等高级<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>语法。</p>
<h3 id="_12">仿真验证<a class="headerlink" href="#_12" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>这里我们使用了差分测试来对代码进行仿真测试，相关原理可见<span class="heti-skip"><span class="heti-spacing"> </span>Lab2-1 Appendix<span class="heti-spacing"> </span></span>其中包括下面的两个文件：</p>
<ul>
<li><code>src/lab2-1/sim/testbench.v</code> 提供了差分测试的调用代码，对拍器负责检查输入输出是否正确，此外另一个检查电路会每隔<span class="heti-skip"><span class="heti-spacing"> </span>10<span class="heti-spacing"> </span></span>时间单位检查对拍器的检测结果，如果检测存在错误则调用 <code>$display()</code> 输出错误信息。</li>
<li><code>src/lab2-1/sim/judge.v</code> 是用于检测 <code>add_subs.v</code> 正确性的对拍器，这里直接用<span class="heti-skip"><span class="heti-spacing"> </span>Verilog<span class="heti-spacing"> </span></span>的 <code>+/-</code> 算子实现加法器和减法器，用 <code>==</code> 算子实现比较器，检测最终结果是否正确。</li>
</ul>
<p>因此，本部分你需要做的是：</p>
<ul>
<li>在 <code>src/lab2-1/sim/testbench.v</code> 中加入<span class="heti-skip"><span class="heti-spacing"> </span>20<span class="heti-spacing"> </span></span>组<strong>随机样例</strong>，然后运行 <code>make verilate</code> 进行仿真测试。请善用<code>$random()</code> 函数、<code>integer</code> 变量和 <code>for</code> 循环。<ul>
<li>每组测试样例之间的时间间隔请大于等于 <strong>20</strong> 个时间单位，不然可能会导致差分测试出错。</li>
</ul>
</li>
</ul>
<h3 id="_13">下板验证<a class="headerlink" href="#_13" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><code>src/lab2-1/include/initial_file.vh</code> 定义了变量 <code>FILE_PATH</code> 的值，用于指示 <code>initial.hex</code> 的文件路径，请大家将 <code>FILE_PATH</code> 设置为自己的 <code>initial.hex</code> 文件的<strong>绝对路径</strong>。当我们<span class="heti-skip"><span class="heti-spacing"> </span>verilate<span class="heti-spacing"> </span></span>仿真的时候使用的是<span class="heti-skip"><span class="heti-spacing"> </span>if<span class="heti-spacing"> </span></span>分支的路径，在<span class="heti-skip"><span class="heti-spacing"> </span>Vivado<span class="heti-spacing"> </span></span>仿真或者综合的时候则是使用<span class="heti-skip"><span class="heti-spacing"> </span>else<span class="heti-spacing"> </span></span>分支的路径。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="w">    </span><span class="no">`ifdef</span><span class="w"> </span><span class="n">VERILATE</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">        </span><span class="k">localparam</span><span class="w"> </span><span class="n">FILE_PATH</span><span class="o">=</span><span class="s">"initial.hex"</span><span class="p">;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="no">`else</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">        </span><span class="k">localparam</span><span class="w"> </span><span class="n">FILE_PATH</span><span class="o">=</span><span class="s">"D:</span><span class="se">\\</span><span class="s">txt</span><span class="se">\\</span><span class="s">system2</span><span class="se">\\</span><span class="s">sys1-sp24</span><span class="se">\\</span><span class="s">src</span><span class="se">\\</span><span class="s">lab2-1</span><span class="se">\\</span><span class="s">build</span><span class="se">\\</span><span class="s">verilate</span><span class="se">\\</span><span class="s">initial.hex"</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="no">`endif</span>
</code></pre></div></td></tr></table></div>
<p>运行 <code>make bitstream</code> 或者自行通过<span class="heti-skip"><span class="heti-spacing"> </span>Vivado<span class="heti-spacing"> </span></span>创建工程，并综合生成比特流，随后下板验证。</p>
<details>
<summary><code>top.v</code> 工作原理</summary>
<p><code>top.v</code> 的电路图如下：
</p><center>
<img alt="led" src="../img/lab2-1/top.png" width="400"/>
</center>
<p>我们对语法和输入输出做一个简单的描述，具体的细节，大家自行结合电路图和代码进行理解。</p>
<p>下面是 <code>repo/sys-project/lab2-1/syn/top.v</code> 中的部分代码，这里 <code>FILE_PATH</code> 是 <code>initial.hex</code> 的文件路径，<span>adder<span class="heti-spacing"> </span></span>用于存储测试的数据。然后 <code>$readmemh</code> 函数将 <code>initial.hex</code> 文件的<span class="heti-skip"><span class="heti-spacing"> </span>8<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>64<span class="heti-spacing"> </span></span>位数据分别初始化<span class="heti-skip"><span class="heti-spacing"> </span>adder<span class="heti-spacing"> </span></span>的每一个成员的每一个<span><span class="heti-spacing"> </span>bit</span>。特别的，虽然 <code>$readmemh</code>是 <code>initial</code> 块的代码，且我们一再强调 <code>initial</code> 的仿真代码不会被综合生成电路，但是 <code>$readmemh</code> 是一个例外，因此下板之后<span class="heti-skip"><span class="heti-spacing"> </span>adder<span class="heti-spacing"> </span></span>的值真的会被初始化为 <code>initial.hex</code> 的值。
</p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="w">    </span><span class="no">`include</span><span class="s">"initial_file.vh"</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">adder</span><span class="w"> </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">7</span><span class="p">];</span><span class="c1">//这个顺序很重要</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">        </span><span class="nb">$readmemh</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">,</span><span class="w"> </span><span class="n">adder</span><span class="p">);</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="k">end</span>
</code></pre></div></td></tr></table></div>
<code>repo/sys-project/lab2-1/syn/initial.hex</code> 存储了测试数据，可以看到每一行都是 16 位的 16 进制数，这就代表了一个 64 位数据的数值，一共有 8 个。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>    0123456789abcdef
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    473950283859bcda
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>    1029bacd28dbcfa0
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    10294753bacdefbd
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>    38472bdfacef2634
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>    aef827527384facd
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>    83726485937facde
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    afced27829378236
</code></pre></div></td></tr></table></div>
</details>
<p>将比特流烧录到实验板上，然后通过开关和数码管的显示值验证电路的正确性。</p>
<ul>
<li><code>sw[1:0]</code> 选择<span class="heti-skip"><span class="heti-spacing"> </span>adder<span class="heti-spacing"> </span></span>中的<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>组测试样例的一组。</li>
<li><code>sw[2]</code> 选择做加法还是减法。</li>
<li><code>sw[5:3]</code> 选择输出<span><span class="heti-spacing"> </span>a</span>、b、s、<span>c<span class="heti-spacing"> </span></span>的值的高<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位还是低<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位。</li>
<li><code>SEG</code> 显示<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位数据的值。</li>
</ul>
<h2 id="100">实验报告<font color="Red"><span><span class="heti-spacing"> </span>100%</span></font><a class="headerlink" href="#100" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ol>
<li>
<p>请在实验报告中详细描述每一步的过程并配有适当的截图和解释，对于仿真设计和上板验证的结果也应当有适当的解释和照片。<font color="Red">Total : 50%</font></p>
<blockquote>
<p>细分：</p>
<ul>
<li>使用 <code>for</code> 语句进行仿真和综合<font color="Red"><span><span class="heti-spacing"> </span>15%</span></font></li>
<li>使用 <code>$random()</code> 函数进行仿真样例生成<font color="Red"><span><span class="heti-spacing"> </span>15%</span></font></li>
<li>综合实现全加减法器<font color="Red"><span><span class="heti-spacing"> </span>20%</span></font></li>
</ul>
</blockquote>
</li>
<li>
<p>思考如下问题：</p>
<ul>
<li>对于 <code>repo/sys-project/lab2-1/syn/top.v</code> 中的 <code>reg [63:0] adder [0:7]</code>，请依次替换为下面的四种格式
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">63</span><span class="p">]</span><span class="w"> </span><span class="n">adder</span><span class="w"> </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">7</span><span class="p">];</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">63</span><span class="p">]</span><span class="w"> </span><span class="n">adder</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">adder</span><span class="w"> </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">7</span><span class="p">];</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">127</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">adder</span><span class="w"> </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">7</span><span class="p">];</span>
</code></pre></div></td></tr></table></div>
    通过仿真或者综合下板观察 adder 的每个 bit 会被初始化为何值？请尝试对每一种格式都进行仿真或者综合，并对 <code>readmemh</code> 如何初始化一维向量数组的每个 bit 给出结论。<font color="Red">25%</font></li>
<li>请思考相对于超前进位加法器，行波进位加法器存在什么缺点？<font color="Red">10%</font></li>
<li>如何表示运算溢出？请给出溢出表示的布尔代数（用 <code>Adder_32</code> 的输入与输出计算<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。<font color="Red">15%</font></li>
</ul>
</li>
</ol>
<h2 id="_14">代码提交<a class="headerlink" href="#_14" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="100_1">验收检查点<font color="Red"><span><span class="heti-spacing"> </span>100%</span></font><a class="headerlink" href="#100_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>仿真波形展示<font color="Red"><span><span class="heti-spacing"> </span>30%</span></font></li>
<li>代码解释或设计思路<font color="Red"><span><span class="heti-spacing"> </span>30%</span></font></li>
<li>下板验证<font color="Red"><span><span class="heti-spacing"> </span>40%</span></font></li>
</ul>
<h3 id="_15">提交文件<a class="headerlink" href="#_15" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><code>src/lab2-1/</code> 中编写的 <code>submit/</code> 和 <code>sim/</code> 目录下的代码。</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 第二部分" class="md-footer__link md-footer__link--prev" href="../lab1-2/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                第二部分
              </div>
</div>
</a>
<a aria-label="Next: 附录：参数式编程" class="md-footer__link md-footer__link--next" href="../lab2-1-appendix/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                附录：参数式编程
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "navigation.tracking", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
<script src="https://cdn.tonycrane.cc/utils/katex.min.js"></script>
<script src="../js/katex.js"></script>
</body>
</html>